var pri_key = "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"
var pub_key = "MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAroC9jEvOYRC12PUiDK7NgTwkKADbcMalBW9qy7Hdr8hht1PgkjfJXl+VNndcocyUo+oO6gs8ufRKxl98/N+CTdv/Su08qZ8csxUcapGaLAJhS+Iv4dUOM5zi2v2xMK9ueR8kicId7PlT83S6k7INanl7O/iTXDylWteRK3uh+ZxhAETxsZQ2SFJhC1n4LNarQgd8+ijNKs2PZQzrHh36ksTGUKDxwDdPSQ91cGLlxNrwQZqPiON9XYH6+OhLaKb0R9Asb51A5rCrE7DgGukLQqvgkGoWJ+emqIpEpY2AioUWk13nKA/PPnkxITC6aVtQPw4sjfdtcOYTKf9S0GzsGTKD0sm/urKk4rWNxKRhxP8xathuxqgmNN9NiYWfRMMors4YXYul/xrM8tvAzsUJcuiwDqKo0F1LQyT3gyvl+YWAFCNBuoADZeFX4Z0zQyG5HXluonAJ/vEvEk/o+0yoAyc8ET2SYcgpKmOLZYiRvrc7RbEyMtHBY4W/P9+eE5i5eLZXSiJNEHe+D3nusiMj+IITrJm4jQ47W+guusLOcFA2OHJZ38xwc0UWaYMPEZkTqKU51ik+rE4Lzm97lzFGB4Zzbb9uLYOdVeEuUeEd2AWqoInSGmVDQGx4p3ilz29O2niW1D4qYzsOUKfrhAxXU1qGqwQzwAiHNiZodxRgdGMCAwEAAQ=="


var a = {"pub_key":"MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAroC9jEvOYRC12PUiDK7NgTwkKADbcMalBW9qy7Hdr8hht1PgkjfJXl+VNndcocyUo+oO6gs8ufRKxl98/N+CTdv/Su08qZ8csxUcapGaLAJhS+Iv4dUOM5zi2v2xMK9ueR8kicId7PlT83S6k7INanl7O/iTXDylWteRK3uh+ZxhAETxsZQ2SFJhC1n4LNarQgd8+ijNKs2PZQzrHh36ksTGUKDxwDdPSQ91cGLlxNrwQZqPiON9XYH6+OhLaKb0R9Asb51A5rCrE7DgGukLQqvgkGoWJ+emqIpEpY2AioUWk13nKA/PPnkxITC6aVtQPw4sjfdtcOYTKf9S0GzsGTKD0sm/urKk4rWNxKRhxP8xathuxqgmNN9NiYWfRMMors4YXYul/xrM8tvAzsUJcuiwDqKo0F1LQyT3gyvl+YWAFCNBuoADZeFX4Z0zQyG5HXluonAJ/vEvEk/o+0yoAyc8ET2SYcgpKmOLZYiRvrc7RbEyMtHBY4W/P9+eE5i5eLZXSiJNEHe+D3nusiMj+IITrJm4jQ47W+guusLOcFA2OHJZ38xwc0UWaYMPEZkTqKU51ik+rE4Lzm97lzFGB4Zzbb9uLYOdVeEuUeEd2AWqoInSGmVDQGx4p3ilz29O2niW1D4qYzsOUKfrhAxXU1qGqwQzwAiHNiZodxRgdGMCAwEAAQ=="}

var u2 = require('/root/code/node_webs/node_modules/util2.js')
var default_data = {

    "clientAmount"  : 29.9,
    "trxNo"         : 457171434654203900,
    "clientCurrency": "CNY",
    "notifyTime"    : 1676870194264,
    "channel"       : 1,
    "outTrxNo"      : "D7AE0F64-DC6E-4579-82B4-1F02D3920852",
    "platform"      : 1,
    "paymentType"   : 0,
    "products"      : [{"productCode": "3010", "quantity": 1, "channelSkuCode": "com.tds.sdkdemopro.fxqusd299"}],
    "clientRegion"  : "CN",
    "totalAmount"   : 2000,
    "appId"         : 1111,
    "successTime"   : 1688724571000,
    "currency"      : "USD",
    "notifyId"      : 457171562190405600,
    "region"        : "HK",
    "status"        : 0
    // "attach"      : {"gameServerId": "999", "gameExt": "0502307040799000001", "gameRoleId": "11111"},
    // "bankTrxNo"     : "0502307070295000001",
    // "trxType"       : 0,
    // "userId"        : "11111",

}

var main = function (bankTrxNo, trxType, userId, attach, outTrxNo) {
    var set_data = {bankTrxNo, trxType, userId, attach, outTrxNo}
    var data = Object.assign({}, default_data)

    Object.keys(set_data).filter(i => set_data[i] !== undefined).forEach(i => data[i] = set_data[i])
    // data = {"clientAmount":29.9,"trxNo":457171434654203900,"clientCurrency":"CNY","notifyTime":1676870194264,"channel":1,"outTrxNo":"D7AE0F64-DC6E-4579-82B4-1F02D3920852","platform":1,"paymentType":0,"products":[{"productCode":"3010","quantity":1,"channelSkuCode":"com.tds.sdkdemopro.fxqusd299"}],"clientRegion":"CN","totalAmount":2000,"appId":1111,"successTime":1676870194228,"currency":"USD","notifyId":"457171562190405600","region":"HK","status":0,"bankTrxNo":"0502307070295000002","trxType":2,"userId":"20013_1","attach":{"gameServerId": "nh-gat-inner", "gameExt": "0502307070295000002", "gameRoleId": "11111"},}
    data.attach  = Object.assign(data.attach ,{"gameServerId": "nh-gat-inner"})

    // data = {"bankTrxNo":"GPA.3339-9733-0531-71739","clientAmount":1.26,"trxNo":510815340696248300,"clientCurrency":"SGD","notifyTime":1689659873902,"channel":2,"trxType":2,"userId":"506877537968984065","outTrxNo":"0502307180195000004","platform":2,"paymentType":0,"products":[{"productCode":"global.recharge.infinite10","quantity":1,"channelSkuCode":"10030"}],"clientRegion":"SG","totalAmount":0.99,"appId":2068001,"successTime":1689659873880,"currency":"USD","notifyId":510815366658990100,"attach":{"gameServerId":"nh-gat-inner","gameExt":"0502307180195000004","gameRoleId":"20013_9"},"region":"TW","status":0}
    data = {"bankTrxNo":"GPA.3339-9733-0531-71739","clientAmount":1.26,"trxNo":510815340696248300,"clientCurrency":"SGD","notifyTime":1689659873902,"channel":2,"trxType":0,"userId":"506877537968984065","outTrxNo":"0502307180195000004","platform":2,"paymentType":0,"products":[{"productCode":"global.recharge.infinite10","quantity":1,"channelSkuCode":"3010"}],"clientRegion":"SG","totalAmount":0.99,"appId":1111,"successTime":1689659873880,"currency":"USD","notifyId":510815366658990100,"attach":{"gameServerId":"nh-gat-inner","gameExt":"0502307180495000003","gameRoleId":"20013_1"},"region":"TW","status":0}




    var str = "POST" + "\n"
    str += "/buy_result/cp/50/20013" + "\n"
    str += "12312312312" + "\n"
    str += "12312312312" + "\n"
    str += JSON.stringify(data) + "\n"
    var con = u2.rsa_sign(str, pri_key, "sha256")
    console.log('data',JSON.stringify(data))
    console.log(con)

    var res = u2.rsa_verify(str, pub_key, con, 'sha256')
    console.log(res, 22222)
    console.log('-------------------------------------')
    console.log('-------------------------------------')
    console.log('-------------------------------------')
}
// 下单回调

function init(){
    // 订单号, 是否退款trxType：0成功，2退款，1补单（不会出现）
    main("0502307110295000001", 0, 'ddddx20013_1',{"gameExt": "0502307110295000001", "gameRoleId": "20013_1"}) // 有成功没有问题
    main("0502307110295000001", 0, 'dddx20013_1',{"gameExt": "0502307110295000001"}) // 有成功没有问题
    //
    // main("0502307070295000002", 1, '20013_1', {"gameExt": "0502307070295000002", "gameRoleId": "20013_1"}) // 结果失败-没问题
    //
    // main("0502307070295000012", 2, '20013_1') // 有点问题,common_refund_orders ,没存订单号
    main("0502307070295000012", 2, '20013_1', {"gameExt": "0502307070295000012", "gameRoleId": "20013_1"}) // ok没问题


    // 页面支付，透传参数

    // main(null, 0, "20013_1", {"gameRoleId": "20013_1"}) // 结果失败-没问题
    // main(null, 1, "20013_1", {"gameRoleId": "20013_1"}) // 结果失败-没问题
    // main(null, 2, "20013_1", {"gameRoleId": "20013_1"}) // 结果失败-没问题
    //
    main(null, 0, undefined, {"gameRoleId": "20013_1"}, '457170214115934200')
    // main(null, 1, undefined, {"gameRoleId": "20013_1"}, '457170214115934201') // 结果失败-没问题
    // main(null, 2, undefined, {"gameRoleId": "20013_1"}, '457170214115934202') // 没问题

    // main(null, 0, undefined, {"gameRoleId": "20013_1"}, '457170214115934204')

}
init()
